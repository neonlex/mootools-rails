(function(a){window.rails={applyEvents:function(b){b=a(b||document.body);var c=function(a,c,d){b.getElements(a).addEvent(c,d)};c('form[data-remote="true"]',"submit",rails.handleRemote),c('a[data-remote="true"], input[data-remote="true"]',"click",rails.handleRemote),c("a[data-method][data-remote!=true]","click",function(a){a.preventDefault();if(rails.confirmed(this)){var b=(new Element("form",{method:"post",action:this.get("href"),styles:{display:"none"}})).inject(this,"after"),c=new Element("input",{type:"hidden",name:"_method",value:this.get("data-method")}),d=new Element("input",{type:"hidden",name:rails.csrf.param,value:rails.csrf.token});b.adopt(c,d).submit()}});var d=":not([data-method]):not([data-remote=true])[data-confirm]";c("a"+d+","+"input"+d,"click",function(){return rails.confirmed(this)})},getCsrf:function(a){var b=document.getElement("meta[name=csrf-"+a+"]");return b?b.get("content"):null},confirmed:function(a){var b=a.get("data-confirm");if(b&&!confirm(b))return!1;return!0},disable:function(a){var b=a.get("data-disable-with")?a:a.getElement("[data-disable-with]");if(b){var c=b.get("value");a.addEvent("ajax:complete",function(){b.set({value:c,disabled:!1})}),b.set({value:b.get("data-disable-with"),disabled:!0})}},handleRemote:function(a){a.preventDefault(),rails.confirmed(this)&&(this.request=new Request.Rails(this),rails.disable(this),this.request.send())}},Request.Rails=new Class({Extends:Request,initialize:function(a,b){this.el=a,this.parent(Object.merge({method:this.el.get("method")||this.el.get("data-method")||"get",url:this.el.get("action")||this.el.get("href")},b)),this.addRailsEvents()},send:function(a){this.el.fireEvent("ajax:before"),this.el.get("tag")=="form"&&(this.options.data=this.el),this.parent(a),this.el.fireEvent("ajax:after",this.xhr)},addRailsEvents:function(){this.addEvent("request",function(){this.el.fireEvent("ajax:loading",this.xhr)}),this.addEvent("success",function(){this.el.fireEvent("ajax:success",this.xhr)}),this.addEvent("complete",function(){this.el.fireEvent("ajax:complete",this.xhr),this.el.fireEvent("ajax:loaded",this.xhr)}),this.addEvent("failure",function(){this.el.fireEvent("ajax:failure",this.xhr)})}})})(document.id),window.addEvent("domready",function(){rails.csrf={token:rails.getCsrf("token"),param:rails.getCsrf("param")},rails.applyEvents()})